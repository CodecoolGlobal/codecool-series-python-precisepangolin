<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">

    <title>Shows</title>

    <!-- Import Montserrat font -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <!-- Normalize.css fixes lot of differences between browsers default styles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css"/>

    <!-- project wide styling -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style/site.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/header.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/footer.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/background.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/button.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/card.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/table.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/form.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/grid.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/utils.css') }}">

    <!-- page specific styling -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style/detailed-view.css') }}">
</head>

<body>
<div id="body-wrapper">
    <header class="clearfix">
        <img id="header-logo" src="{{ url_for('static', filename='assets/codecool-logo.png') }}" alt="Codecool Logo">
        <span id="header-title" class="title">Codecool Series DB</span>
        <div id="header-auth">
            <button type="button" id="bt-register">Register</button>
            <button type="button" id="bt-login">Login</button>
        </div>
    </header>
    <section>
        <h1 class="title text-center">Shows</h1>
        <div class="card">
            <p>Here is a list of fifteen highest rated shows:</p>
<script>
    var direction = [];
    direction['title'] = 'DESC';
    direction['rating'] = 'DESC';
    direction['year'] = 'DESC';
    direction['runtime'] = 'DESC';
    function order(by){
        let order = direction[by];

        if(order == 'DESC') direction[by] = 'ASC';
        else direction[by] = 'DESC';

        fetch('/api/json/shows/order-by-'+by+'-'+order).then(response=>response.json()).then(data=>
        {
            let tbody = document.getElementById('shows');

            tbody.innerHTML = "";
            for(record of data){
                let recordTr = document.createElement('tr');
                let titleTd =document.createElement('td');
                titleTd.appendChild(document.createTextNode(record.title));
                let yearTd = document.createElement('td');
                yearTd.appendChild(document.createTextNode(record.year));
                let runtimeTd = document.createElement('td');
                runtimeTd.appendChild(document.createTextNode(record.runtime));
                let ratingTd = document.createElement('td');
                ratingTd.appendChild(document.createTextNode(record.rating));
                let genresTd = document.createElement('td');
                genresTd.appendChild(document.createTextNode(record.genres));
                let trailerTd = document.createElement('td');
                if(record.trailer != null) trailerTd.appendChild(document.createTextNode(record.trailer))
                else trailerTd.appendChild(document.createTextNode("No URL"));
                let homepageTd = document.createElement('td');
                if(record.homepage != null) homepageTd.appendChild(document.createTextNode(record.homepage))
                else homepageTd.appendChild(document.createTextNode("No URL"));
                recordTr.appendChild(titleTd);
                recordTr.appendChild(yearTd);
                recordTr.appendChild(runtimeTd);
                recordTr.appendChild(ratingTd);
                recordTr.appendChild(genresTd);
                recordTr.appendChild(trailerTd);
                recordTr.appendChild(homepageTd);
                tbody.appendChild(recordTr);
            }



        })

            let titleH = document.getElementById('titleH');
            if(direction['title'] === "DESC")
            titleH.innerHTML = "<a href='javascript:order(%27title%27)'>Title ▾</a>"
            else if(direction['title'] === "ASC")
            titleH.innerHTML = "<a href='javascript:order(%27title%27)'>Title ▴</a>"
            else titleH.innerHTML = "<a href='javascript:order(%27title%27)'>Title</a>";
    }
</script>
<table><thead>
<tr id="headers">
    <th id="titleH">
        <a href="javascript:order('title')">Title</a>
    </th>
    <th id="yearH">
    <a href="javascript:order('year')">Year {% if order == "ASC" %}DESC{% else %}ASC{% endif %}</a>
    </th>
    <th id="runH">
    <a href="javascript:order('runtime')">Runtime (min)</a>
    </th>
    <th id="ratingH">
    <a href="javascript:order('rating')">Rating</a>
    </th>
    <th>Genres</th>
    <th>Trailer</th>
    <th>Homepage</th>
</tr>
</thead>
<tbody id="shows">{% for show in shows %}
<tr>
    <td>
    <a href="{{ "/shows/" + (show['id']|string) }}">{{ show['title'] }}</a>
    </td>
<td>{{ show['year'] }}</td>
<td>{{ show['runtime'] }}</td>
<td>{{ show['rating'] }}</td>
<td>{{ show['genres'] }}</td>
<td>{%  if show['trailer'] %}
    <a href={{ show['trailer']|string}}>{{ show['trailer'] }}</a>
{% else %}
    No URL
{%  endif %}
</td>
<td>{%  if show['homepage'] %}
    <a href={{ show['homepage']|string}}>{{ show['homepage'] }}</a>
{% else %}
    No URL
{%  endif %}
</td>
</tr>
{% endfor %}
</tbody>

</table>
        </div>
<div class="card">
    <div class="pagination">
        {% if page_number == 1 %}
            <a href="#">&lsaquo;</a>
        {% else %}
            <a href="/shows/most-rated/1">&laquo;</a>
            <a href="/shows/most-rated/{{ page_number - 1 }}">&lsaquo;</a>
        {% endif %}


        {%  for i in range(shown_page_start, shown_page_end + 1) %}
            {% if page_number == i %}
                <a href="/shows/most-rated/{{ i }}">({{ i }})</a>
            {% else %}
                <a href="/shows/most-rated/{{ i }}">{{ i }}</a>
            {% endif %}

        {% endfor %}

        {% if page_number == page_count %}
            <a href="#">&rsaquo;</a>
        {% else %}
            <a href="/shows/most-rated/{{ page_number + 1 }}">&rsaquo;</a>
            <a href="/shows/most-rated/{{ page_count - 1 }}">&raquo;</a>
        {% endif %}
    </div>
</div>


    </section>
    <footer>
        Copyright, bla-bla
    </footer>
</div>
 <div class="background">
    <div class="dark-blue-layer"></div>
    <div class="light-blue-layer"></div>
</div>
</body>
</html>